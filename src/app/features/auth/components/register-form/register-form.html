<form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
  <mat-card class="register-form__card">
    <mat-card-header class="register-form__header">
      <mat-card-title class="register-form__title">
        Create Account
      </mat-card-title>
    </mat-card-header>

    <mat-card-content class="register-form__content">
      <div class="register-form__grid">
        <mat-form-field appearance="outline" class="register-form__field">
          <mat-label>First Name</mat-label>
          <input matInput type="text" formControlName="firstName" autocomplete="given-name">
          @if (firstName.hasError('required')) {
          <mat-error>First name is required</mat-error>
          }
          @if (firstName.hasError('minlength')) {
          <mat-error>First name must be at least 1 character</mat-error>
          }
          @if (firstName.hasError('maxlength')) {
          <mat-error>First name must be at most 20 characters</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="register-form__field">
          <mat-label>Last Name</mat-label>
          <input matInput type="text" formControlName="lastName" autocomplete="family-name">
          @if (lastName.hasError('required')) {
          <mat-error>Last name is required</mat-error>
          }
          @if (lastName.hasError('minlength')) {
          <mat-error>Last name must be at least 1 character</mat-error>
          }
          @if (lastName.hasError('maxlength')) {
          <mat-error>Last name must be at most 20 characters</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="register-form__field">
          <mat-label>Email</mat-label>
          <input matInput type="email" formControlName="email" autocomplete="email">
          @if (email.hasError('required')) {
          <mat-error>Email is required</mat-error>
          }
          @if (email.hasError('email')) {
          <mat-error>Invalid email format</mat-error>
          }
          @if (email.hasError('maxlength')) {
          <mat-error>Email must be at most 254 characters</mat-error>
          }
        </mat-form-field>

        <div class="register-form__password-container">
          <mat-form-field appearance="outline" class="register-form__field">
            <mat-label>Password</mat-label>
            <input matInput [type]="hide() ? 'password' : 'text'" formControlName="password"
              autocomplete="new-password">
            <button type="button" matIconButton matSuffix (click)="clickEvent($event)"
              [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hide()">
              <mat-icon>{{hide() ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>

            @if (password.hasError('required') && password.touched) {
            <mat-error>Password is required</mat-error>
            }
            @if (password.hasError('minlength') && password.touched) {
            <mat-error>Password must be at least 8 characters</mat-error>
            }
            @if (password.hasError('maxlength') && password.touched) {
            <mat-error>Password must be at most 128 characters</mat-error>
            }
            @if (password.hasError('passwordComplexity') && password.touched && !password.hasError('minlength')) {
            <mat-error>Password must meet all requirements below</mat-error>
            }
          </mat-form-field>

          @if (password.value && hasUnmetRequirements()) {
          <div class="password-requirements">
            <div class="password-requirements__list">
              @if (!hasLowercase()) {
              <div class="password-requirements__item">
                <mat-icon>cancel</mat-icon>
                <span>One lowercase letter</span>
              </div>
              }
              @if (!hasUppercase()) {
              <div class="password-requirements__item">
                <mat-icon>cancel</mat-icon>
                <span>One uppercase letter</span>
              </div>
              }
              @if (!hasDigit()) {
              <div class="password-requirements__item">
                <mat-icon>cancel</mat-icon>
                <span>One number</span>
              </div>
              }
              @if (!hasSpecialChar()) {
              <div class="password-requirements__item">
                <mat-icon>cancel</mat-icon>
                <span>One special character</span>
              </div>
              }
              @if (!hasMinLength()) {
              <div class="password-requirements__item">
                <mat-icon>cancel</mat-icon>
                <span>At least 8 characters</span>
              </div>
              }
            </div>
          </div>
          }
        </div>

        <mat-form-field appearance="outline" class="register-form__field">
          <mat-label>Confirm Password</mat-label>
          <input matInput [type]="hide() ? 'password' : 'text'" formControlName="confirmPassword"
            autocomplete="new-password">
          <button type="button" matIconButton matSuffix (click)="clickEvent($event)" [attr.aria-label]="'Hide password'"
            [attr.aria-pressed]="hide()">
            <mat-icon>{{hide() ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>

          @if (confirmPassword.hasError('required') && confirmPassword.touched) {
          <mat-error>Please confirm your password</mat-error>
          }
          @if (confirmPassword.hasError('passwordMismatch') && confirmPassword.touched) {
          <mat-error>Passwords do not match</mat-error>
          }
          @if (passwordsMatch() && confirmPassword.touched) {
          <mat-hint class="password-match-hint">
            <span>Passwords match</span>
          </mat-hint>
          }
        </mat-form-field>
      </div>
    </mat-card-content>

    <mat-card-actions class="register-form__actions">
      <div class="register-form__actions-container">
        <button mat-flat-button color="primary" type="submit" [disabled]="registerForm.invalid"
          class="register-form__submit">
          Sign Up
        </button>

        <div class="register-form__footer">
          <p>Already have an account? <a routerLink="/login">Log in</a></p>
        </div>
      </div>
    </mat-card-actions>

    <mat-card-footer>
      @if (errorMessage()) {
      <div class="register-form__error-alert">
        <mat-icon>error</mat-icon>
        <span>{{ errorMessage() }}</span>
      </div>
      }
    </mat-card-footer>
  </mat-card>
</form>
