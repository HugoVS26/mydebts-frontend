<form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="reset-password-form">
  <mat-card class="reset-password-form__card">
    <mat-card-header class="reset-password-form__header">
      <mat-card-title class="reset-password-form__title">
        Reset Password
      </mat-card-title>
    </mat-card-header>

    <mat-card-content class="reset-password-form__content">
      <div class="reset-password-form__grid">

        <div class="reset-password-form__password-container">
          <mat-form-field appearance="outline" class="reset-password-form__field">
            <mat-label>New Password</mat-label>
            <input matInput [type]="hide() ? 'password' : 'text'" formControlName="password"
              autocomplete="new-password">
            <button type="button" matIconButton matSuffix (click)="clickEvent($event)"
              [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hide()">
              <mat-icon>{{ hide() ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>

            @if (password.hasError('required') && password.touched) {
            <mat-error>Password is required</mat-error>
            }
            @if (password.hasError('minlength') && password.touched) {
            <mat-error>Password must be at least 8 characters</mat-error>
            }
            @if (password.hasError('maxlength') && password.touched) {
            <mat-error>Password must be at most 128 characters</mat-error>
            }
            @if (password.hasError('passwordComplexity') && password.touched && !password.hasError('minlength')) {
            <mat-error>Password must meet all requirements below</mat-error>
            }
          </mat-form-field>

          @if (password.value && hasUnmetRequirements()) {
          <div class="password-requirements">
            <div class="password-requirements__list">
              @if (!hasLowercase()) {
              <div class="password-requirements__item">
                <mat-icon>cancel</mat-icon>
                <span>One lowercase letter</span>
              </div>
              }
              @if (!hasUppercase()) {
              <div class="password-requirements__item">
                <mat-icon>cancel</mat-icon>
                <span>One uppercase letter</span>
              </div>
              }
              @if (!hasDigit()) {
              <div class="password-requirements__item">
                <mat-icon>cancel</mat-icon>
                <span>One number</span>
              </div>
              }
              @if (!hasSpecialChar()) {
              <div class="password-requirements__item">
                <mat-icon>cancel</mat-icon>
                <span>One special character</span>
              </div>
              }
              @if (!hasMinLength()) {
              <div class="password-requirements__item">
                <mat-icon>cancel</mat-icon>
                <span>At least 8 characters</span>
              </div>
              }
            </div>
          </div>
          }
        </div>

        <mat-form-field appearance="outline" class="reset-password-form__field">
          <mat-label>Confirm Password</mat-label>
          <input matInput [type]="hide() ? 'password' : 'text'" formControlName="confirmPassword"
            autocomplete="new-password">
          <button type="button" matIconButton matSuffix (click)="clickEvent($event)" [attr.aria-label]="'Hide password'"
            [attr.aria-pressed]="hide()">
            <mat-icon>{{ hide() ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>

          @if (confirmPassword.hasError('required') && confirmPassword.touched) {
          <mat-error>Please confirm your password</mat-error>
          }
          @if (confirmPassword.hasError('passwordMismatch') && confirmPassword.touched) {
          <mat-error>Passwords do not match</mat-error>
          }
          @if (passwordsMatch() && confirmPassword.touched) {
          <mat-hint class="password-match-hint">
            <span>Passwords match</span>
          </mat-hint>
          }
        </mat-form-field>

      </div>
    </mat-card-content>

    <mat-card-actions class="reset-password-form__actions">
      <div class="reset-password-form__actions-container">
        <button mat-flat-button color="primary" type="submit" [disabled]="resetPasswordForm.invalid"
          class="reset-password-form__submit">
          Reset Password
        </button>
      </div>
    </mat-card-actions>

    <mat-card-footer>
      @if (errorMessage()) {
      <div class="reset-password-form__error-alert">
        <mat-icon>error</mat-icon>
        <span>{{ errorMessage() }}</span>
      </div>
      }
    </mat-card-footer>
  </mat-card>
</form>
